<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kinh D·ªãch Th·ªÉ ‚Äì D·ª•ng by Nguy·ªÖn H·ªìng Qu√¢n</title>
<style>
  :root{
    --bg:#000;
    --gold:#ffd666;
    --accent:#ffcc00;
    --muted:#777;
    --panel:#0b0b0b;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--gold);font-family: "Helvetica Neue", Arial, sans-serif;}
  .wrap{max-width:940px;margin:24px auto;padding:20px;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;}
  h1{margin:0;color:var(--accent);font-size:20px;letter-spacing:1px;}
  p.lead{margin:6px 0 14px;color:var(--muted);font-size:13px;}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,204,0,0.08);padding:14px;border-radius:10px;}
  label{display:block;text-align:left;color:var(--gold);font-weight:600;margin-top:10px;font-size:13px;}
  input[type=number], input[type=text], select, textarea{
    width:100%;box-sizing:border-box;padding:8px;border-radius:8px;border:1px solid rgba(255,204,0,0.12);
    background:#070707;color:var(--gold);font-size:14px;margin-top:6px;
  }
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
  .controls{display:flex;gap:8px;margin-top:10px;align-items:center;}
  button{
    background:linear-gradient(180deg,var(--accent),#ffb700);color:#111;border:none;padding:10px 14px;border-radius:8px;font-weight:700;cursor:pointer;
  }
  button.ghost{background:transparent;border:1px solid rgba(255,204,0,0.12);color:var(--gold);}
  .result{margin-top:16px;padding:14px;border-radius:10px;border:1px solid rgba(255,204,0,0.08);background:rgba(255,255,255,0.01);}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
  .element-pill{padding:6px 10px;border-radius:18px;background:rgba(255,204,0,0.06);border:1px solid rgba(255,204,0,0.06);display:inline-block;}
  .ring{width:160px;height:160px;border-radius:50%;position:relative;margin:12px auto;display:grid;place-items:center;}
  .ring .el{position:absolute;width:60px;height:30px;display:grid;place-items:center;border-radius:6px;background:rgba(255,204,0,0.04);border:1px solid rgba(255,204,0,0.06);font-size:13px}
  .el.kim{top:8px;left:50%;transform:translateX(-50%);} 
  .el.moc{right:8px;top:50%;transform:translateY(-50%);} 
  .el.thuy{left:8px;top:50%;transform:translateY(-50%);} 
  .el.hoa{bottom:8px;left:50%;transform:translateX(-50%);} 
  .el.tho{right:50%;transform:translateX(50%);bottom:12px;} 
  footer{margin-top:18px;color:var(--muted);font-size:13px;border-top:1px solid rgba(255,204,0,0.03);padding-top:12px;display:flex;justify-content:space-between;align-items:center;}
  ul.history{padding-left:18px;margin:8px 0 0;color:var(--muted);max-height:260px;overflow:auto;border-top:1px dashed rgba(255,204,0,0.03);padding-top:10px;}
  .small{font-size:12px;color:var(--muted);}
  .badge{display:inline-block;padding:6px 8px;border-radius:6px;background:rgba(255,204,0,0.04);border:1px solid rgba(255,204,0,0.06);font-weight:700}
  .flex-between{display:flex;justify-content:space-between;align-items:center;gap:12px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Kinh D·ªãch Th·ªÉ ‚Äì D·ª•ng</h1>
        <p class="lead">Phi√™n b·∫£n: <span class="small">by Nguy·ªÖn H·ªìng Qu√¢n</span> ‚Äî M·∫°ng ng≈© h√†nh & ƒëi·ªÉm h√≥a nhanh</p>
      </div>
      <div class="small">
        <div class="badge">0896.233.268</div>
      </div>
    </header>

    <section class="card" aria-labelledby="input-title">
      <h2 id="input-title" style="margin:0 0 6px;color:var(--accent)">Nh·∫≠p d·ªØ li·ªáu qu·∫ª</h2>

      <div class="grid">
        <div>
          <label>S·ªë / Seri (Th·ªÉ) ‚Äî ng∆∞·ªùi h·ªèi ho·∫∑c s·ªë th·ª© nh·∫•t</label>
          <input id="num1" type="text" placeholder="VD: 2152998 ho·∫∑c 15" />
        </div>
        <div>
          <label>S·ªë / Seri (D·ª•ng) ‚Äî vi·ªác / ƒë·ªëi t∆∞·ª£ng</label>
          <input id="num2" type="text" placeholder="VD: 0711171 ho·∫∑c 24" />
        </div>
      </div>

      <label>M·ª•c ƒë√≠ch h·ªèi (ch·ªçn ho·∫∑c nh·∫≠p c·ª• th·ªÉ)</label>
      <select id="purposeSelect">
        <option value="congviec">C√¥ng vi·ªác / ·ª®ng tuy·ªÉn</option>
        <option value="tinhduyen">T√¨nh duy√™n</option>
        <option value="taichinh">T√†i ch√≠nh / ƒê·∫ßu t∆∞</option>
        <option value="muaxe">Mua xe</option>
        <option value="muadat">Mua ƒë·∫•t / B·∫•t ƒë·ªông s·∫£n</option>
        <option value="suckhoe">S·ª©c kh·ªèe</option>
        <option value="timdo">T√¨m ƒë·ªì / ng∆∞·ªùi</option>
        <option value="khac">Kh√°c (ghi r√µ)</option>
      </select>
      <input id="purposeText" type="text" placeholder="(T√πy ch·ªçn) M√¥ t·∫£ c·ª• th·ªÉ, v√≠ d·ª•: 'apply v·ªã tr√≠ A' ho·∫∑c 'mua xe ben' " />

      <div class="controls">
        <button onclick="runCalc()">Xem qu·∫ª & t√≠nh ƒëi·ªÉm</button>
        <button class="ghost" onclick="clearForm()">L√†m m·ªõi</button>
        <div style="margin-left:auto" class="small">L∆∞u tr·ªØ: <span id="storageNote">ON</span></div>
      </div>
    </section>

    <section id="output" class="result" style="display:none;">
      <div class="flex-between">
        <div>
          <div><strong>Th·ªÉ:</strong> <span id="elmThe"></span> ‚Äî <small id="sum1" class="small"></small></div>
          <div><strong>D·ª•ng:</strong> <span id="elmDung"></span> ‚Äî <small id="sum2" class="small"></small></div>
          <div style="margin-top:6px"><strong>M·ª•c ƒë√≠ch:</strong> <span id="elmPurpose"></span></div>
        </div>
        <div style="text-align:center">
          <div style="font-size:14px;color:var(--muted)">Quan h·ªá</div>
          <div style="font-size:18px;font-weight:800;margin-top:6px" id="relationText"></div>
        </div>
      </div>

      <div class="ring" aria-hidden="true">
        <div class="el kim" id="elKim">Kim</div>
        <div class="el moc" id="elMoc">M·ªôc</div>
        <div class="el thuy" id="elThuy">Th·ªßy</div>
        <div class="el hoa" id="elHoa">H·ªèa</div>
        <div class="el tho" id="elTho">Th·ªï</div>
      </div>

      <div style="margin-top:6px">
        <strong>ƒêi·ªÉm:</strong> <span id="scoreLarge" style="font-size:20px;font-weight:800"></span>
        <div id="scoreText" class="small" style="margin-top:6px;color:var(--muted)"></div>
      </div>

      <div style="margin-top:12px">
        <strong>K·∫øt lu·∫≠n ng·∫Øn:</strong>
        <div id="conclusion" style="margin-top:6px;color:var(--gold)"></div>
      </div>

      <div style="margin-top:12px;color:var(--muted);font-size:13px" id="detailBox"></div>
    </section>

    <section class="card" style="margin-top:14px">
      <h3 style="margin:0;color:var(--accent)">L·ªãch s·ª≠ (10 l·∫ßn g·∫ßn nh·∫•t)</h3>
      <ul id="history" class="history"></ul>
      <div style="margin-top:10px" class="small">L∆∞u tr√™n tr√¨nh duy·ªát (localStorage). ƒê·ªÉ x√≥a l·ªãch s·ª≠, m·ªü console v√† ch·∫°y: localStorage.removeItem('kdthistory')</div>
    </section>

    <footer>
      <div>üîÆ <strong>Kinh D·ªãch Th·ªÉ ‚Äì D·ª•ng</strong> ‚Äî by <em>Nguy·ªÖn H·ªìng Qu√¢n</em></div>
      <div>üìû Li√™n h·ªá t∆∞ v·∫•n: <strong>0896.233.268</strong></div>
    </footer>
  </div>

<script>
/* --- Quy ∆∞·ªõc & d·ªØ li·ªáu --- */
const ELEMENTS = ["Kim","M·ªôc","Th·ªßy","H·ªèa","Th·ªï"]; // index mapping 0..4
// Sinh (generative): key -> value means key generates value
const GENERATES = {"Kim":"Th·ªßy","Th·ªßy":"M·ªôc","M·ªôc":"H·ªèa","H·ªèa":"Th·ªï","Th·ªï":"Kim"};
// Controls (killing): key -> value means key controls value (kh·∫Øc)
const CONTROLS = {"Kim":"M·ªôc","M·ªôc":"Th·ªï","Th·ªï":"Th·ªßy","Th·ªßy":"H·ªèa","H·ªèa":"Kim"};
// Base points mapping for relation (Th·ªÉ vs D·ª•ng)
const BASE_POINTS = {
  "D->T": 9,   // D·ª•ng sinh Th·ªÉ
  "T->D": 7,   // Th·ªÉ sinh D·ª•ng
  "equal": 6,  // same element
  "T_khac_D": 4, // Th·ªÉ kh·∫Øc D·ª•ng
  "D_khac_T": 3  // D·ª•ng kh·∫Øc Th·ªÉ
};
// Purpose -> element mapping (can be extended)
const PURPOSE_MAP = {
  "congviec":"M·ªôc",
  "tinhduyen":"Th·ªßy",
  "taichinh":"Kim",
  "muaxe":"H·ªèa",
  "muadat":"Th·ªï",
  "suckhoe":"Kim",
  "timdo":"Th·ªßy",
  "khac": null
};

/* --- Utils --- */
function sumDigitsOfString(s){
  // sum digits of given string, ignoring non-digits
  let sum = 0;
  for(let ch of String(s)) {
    if(/\d/.test(ch)) sum += Number(ch);
  }
  return sum;
}
function elementFromNumberRaw(num){
  // given arbitrary number or numeric string: sum digits -> mod 5 -> map
  let total = sumDigitsOfString(num);
  return { total: total, element: ELEMENTS[ total % 5 ] };
}
function countSpecialDigits(s){
  // returns object counts of favorable/unfavorable digits
  let good = 0, bad = 0;
  for(let ch of String(s)){
    if(ch === '6' || ch === '8' || ch === '9') good++;
    if(ch === '0' || ch === '4' || ch === '7') bad++;
  }
  return {good, bad};
}
function capitalize(s){ return String(s).charAt(0).toUpperCase()+String(s).slice(1); }

/* --- Core calculation --- */
function analyze(num1, num2, purposeKey, purposeText){
  // derive element and sums
  const a = elementFromNumberRaw(num1);
  const b = elementFromNumberRaw(num2);

  // relation
  let relation = "equal";
  let points = BASE_POINTS["equal"];
  // Th·ªÉ = a.element, D·ª•ng = b.element
  const T = a.element;
  const D = b.element;

  if(GENERATES[D] === T){ relation = "D->T"; points = BASE_POINTS["D->T"]; }
  else if(GENERATES[T] === D){ relation = "T->D"; points = BASE_POINTS["T->D"]; }
  else if(CONTROLS[T] === D){ relation = "T_khac_D"; points = BASE_POINTS["T_khac_D"]; }
  else if(CONTROLS[D] === T){ relation = "D_khac_T"; points = BASE_POINTS["D_khac_T"]; }

  // detail tally & bonus
  let detail = [];
  detail.push(`Th·ªÉ (${T}) ‚Äî D·ª•ng (${D}). Quan h·ªá c∆° b·∫£n: ${relation.replace(/_/g,' ')}.`);

  // base sums
  let totalBonus = 0;

  // thresholds bonuses
  if(a.total > 50) { totalBonus += 2; detail.push("Th·ªÉ: t·ªïng ch·ªØ s·ªë l·ªõn (>50) ‚Üí +2 ƒëi·ªÉm nƒÉng l∆∞·ª£ng."); }
  else if(a.total > 30) { totalBonus += 1; detail.push("Th·ªÉ: t·ªïng ch·ªØ s·ªë >30 ‚Üí +1."); }
  if(b.total > 50) { totalBonus += 2; detail.push("D·ª•ng: t·ªïng ch·ªØ s·ªë l·ªõn (>50) ‚Üí +2 ƒëi·ªÉm nƒÉng l∆∞·ª£ng."); }
  else if(b.total > 30) { totalBonus += 1; detail.push("D·ª•ng: t·ªïng ch·ªØ s·ªë >30 ‚Üí +1."); }

  // special digit counts
  const s1 = countSpecialDigits(num1);
  const s2 = countSpecialDigits(num2);
  if(s1.good + s2.good >= 2){ totalBonus += 1; detail.push("Xu·∫•t hi·ªán nhi·ªÅu ch·ªØ s·ªë c√°t (6/8/9) ‚Üí +1."); }
  if(s1.bad + s2.bad >= 2){ totalBonus -= 1; detail.push("Xu·∫•t hi·ªán nhi·ªÅu ch·ªØ s·ªë hung (0/4/7) ‚Üí -1."); }

  // if both elements same -> small bonus for harmony
  if(T === D){ totalBonus += 1; detail.push("Th·ªÉ v√† D·ª•ng c√πng h√†nh ‚Üí t∆∞∆°ng h√≤a ‚Üí +1."); }

  // purpose adjustments: map purpose to element and adjust
  let purposeElement = null;
  if(purposeKey && PURPOSE_MAP.hasOwnProperty(purposeKey)) purposeElement = PURPOSE_MAP[purposeKey];
  if(!purposeElement && purposeText && purposeText.trim().length){
    // try to guess from keywords (basic)
    const txt = purposeText.toLowerCase();
    if(/xe|nh√†|b·∫•t ƒë·ªông s·∫£n|ƒë·∫•t/.test(txt)) purposeElement = "Th·ªï";
    else if(/ƒë·∫ßu t∆∞|ti·ªÅn|l·ª£i|t√†i|v·ªën/.test(txt)) purposeElement = "Kim";
    else if(/t√¨nh|y√™u|h·∫πn|y√™u ƒë∆∞∆°ng/.test(txt)) purposeElement = "Th·ªßy";
    else if(/thi|thi c·ª≠|thi tuy·ªÉn/.test(txt)) purposeElement = "H·ªèa";
    else if(/s·ª©c|kh·ªèi|kh·ªèe/.test(txt)) purposeElement = "Kim";
    else if(/vi·ªác|job|apply|c√¥ng vi·ªác/.test(txt)) purposeElement = "M·ªôc";
  }
  if(purposeElement){
    detail.push(`M·ª•c ƒë√≠ch thu·ªôc h√†nh: ${purposeElement}.`);
    // if purpose supports the D (i.e., purpose == D or purpose generates D) => +1
    if(purposeElement === D){ totalBonus += 1; detail.push("M·ª•c ƒë√≠ch tr√πng D·ª•ng ‚Üí +1."); }
    else if(GENERATES[purposeElement] === D){ totalBonus += 1; detail.push("M·ª•c ƒë√≠ch sinh D·ª•ng ‚Üí +1."); }
    // if purpose kh·∫Øc D -> -1
    else if(CONTROLS[purposeElement] === D){ totalBonus -= 1; detail.push("M·ª•c ƒë√≠ch kh·∫Øc D·ª•ng ‚Üí -1."); }
    // if purpose sinh T => tƒÉng kh·∫£ nƒÉng t·ªët cho Th·ªÉ
    if(GENERATES[purposeElement] === T){ totalBonus += 0; /*neutral small effect*/ }
  } else {
    detail.push("M·ª•c ƒë√≠ch ch∆∞a x√°c ƒë·ªãnh h√†nh ch√≠nh x√°c.");
  }

  // final compute
  let finalScore = points + totalBonus;
  // optionally cap minimum 0
  if(finalScore < 0) finalScore = 0;

  // textual verdict
  let verdict = "";
  if(finalScore <= 3) verdict = "Tr√°nh ti·∫øn h√†nh ‚Äì Hung (kh√¥ng thu·∫≠n).";
  else if(finalScore <= 5) verdict = "Kh√¥ng thu·∫≠n ‚Äì N√™n th·∫≠n tr·ªçng, ƒë·ª£i th·ªùi.";
  else if(finalScore <= 7) verdict = "T·∫°m ·ªïn ‚Äì C√≥ th·ªÉ ti·∫øn h√†nh nh∆∞ng ch√∫ √Ω qu·∫£n tr·ªã r·ªßi ro.";
  else if(finalScore <= 9) verdict = "C√°t ‚Äì N√™n ti·∫øn h√†nh, c√≥ l·ª£i.";
  else verdict = "R·∫•t c√°t (thi√™n √Ω m·∫°nh) ‚Äî ∆Øu ti√™n ti·∫øn h√†nh.";

  // summary & full details
  return {
    the: T, dung: D, sum1: a.total, sum2: b.total,
    basePoints: points, bonus: totalBonus, score: finalScore,
    verdict: verdict, detailLines: detail, relation: relation, purposeElement: purposeElement
  };
}

/* --- UI glue --- */
function runCalc(){
  const n1 = document.getElementById('num1').value.trim();
  const n2 = document.getElementById('num2').value.trim();
  const purposeKey = document.getElementById('purposeSelect').value;
  const purposeText = document.getElementById('purposeText').value.trim();

  if(!n1 || !n2){ alert('Vui l√≤ng nh·∫≠p c·∫£ hai s·ªë/seri.'); return; }

  const res = analyze(n1, n2, purposeKey, purposeText);

  // update UI
  document.getElementById('output').style.display = 'block';
  document.getElementById('elmThe').textContent = `${res.the}`;
  document.getElementById('elmDung').textContent = `${res.dung}`;
  document.getElementById('sum1').textContent = `T·ªïng ch·ªØ s·ªë: ${res.sum1}`;
  document.getElementById('sum2').textContent = `T·ªïng ch·ªØ s·ªë: ${res.sum2}`;
  document.getElementById('elmPurpose').textContent = (res.purposeElement ? `${res.purposeElement}` : (purposeText || document.getElementById('purposeSelect').selectedOptions[0].text));
  document.getElementById('relationText').textContent = res.relation.replace(/_/g,' ');
  document.getElementById('scoreLarge').textContent = `${res.score}/10`;
  document.getElementById('scoreText').textContent = res.verdict;
  document.getElementById('conclusion').textContent = res.verdict;
  document.getElementById('detailBox').innerHTML = res.detailLines.map(s => `<div class="small">- ${s}</div>`).join('');

  // highlight elements on ring
  highlightElements(res.the, res.dung, res.purposeElement);

  // store history
  storeHistory({
    time: new Date().toLocaleString(),
    n1, n2,
    the: res.the,
    dung: res.dung,
    score: res.score,
    verdict: res.verdict,
    purpose: purposeText || document.getElementById('purposeSelect').selectedOptions[0].text
  });
  renderHistory();
}

function highlightElements(the, dung, purpose){
  // reset
  ['elKim','elMoc','elThuy','elHoa','elTho'].forEach(id=>{
    const el = document.getElementById(id);
    el.style.background = "rgba(255,204,0,0.04)";
    el.style.border = "1px solid rgba(255,204,0,0.06)";
    el.style.color = "var(--gold)";
  });
  const mapId = { "Kim":"elKim","M·ªôc":"elMoc","Th·ªßy":"elThuy","H·ªèa":"elHoa","Th·ªï":"elTho" };
  if(mapId[the]) {
    const el = document.getElementById(mapId[the]);
    el.style.background = "linear-gradient(90deg, rgba(255,204,0,0.12), rgba(255,180,0,0.06))";
    el.style.border = "1px solid rgba(255,204,0,0.2)";
    el.style.color = "#fff";
  }
  if(mapId[dung]) {
    const el = document.getElementById(mapId[dung]);
    el.style.background = "linear-gradient(90deg, rgba(0,200,255,0.06), rgba(255,204,0,0.06))";
    el.style.border = "1px solid rgba(255,204,0,0.2)";
    el.style.color = "#fff";
  }
  if(purpose && mapId[purpose]){
    const el = document.getElementById(mapId[purpose]);
    el.style.background = "linear-gradient(90deg, rgba(0,255,150,0.06), rgba(255,204,0,0.06))";
    el.style.border = "1px solid rgba(255,204,0,0.2)";
    el.style.color = "#fff";
  }
}

/* --- LocalStorage history --- */
function storeHistory(record){
  try{
    let hist = JSON.parse(localStorage.getItem('kdthistory') || '[]');
    hist.unshift(record);
    if(hist.length>10) hist.pop();
    localStorage.setItem('kdthistory', JSON.stringify(hist));
  }catch(e){ console.warn(e); }
}
function renderHistory(){
  const ul = document.getElementById('history');
  let hist = JSON.parse(localStorage.getItem('kdthistory') || '[]');
  if(hist.length === 0){ ul.innerHTML = "<li class='small'>Ch∆∞a c√≥ l·ªãch s·ª≠</li>"; return; }
  ul.innerHTML = hist.map(h => `<li><strong>${h.time}</strong>: [${h.n1}] ‚Üí ${h.the}  |  [${h.n2}] ‚Üí ${h.dung} ‚Äî <em>${h.score}/10</em> ‚Äî <span class="small">${h.purpose}</span></li>`).join('');
}
function clearForm(){
  document.getElementById('num1').value='';
  document.getElementById('num2').value='';
  document.getElementById('purposeText').value='';
  document.getElementById('purposeSelect').value='congviec';
  document.getElementById('output').style.display='none';
}

/* boot */
renderHistory();

</script>
</body>
</html>